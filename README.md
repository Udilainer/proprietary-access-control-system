# Custom Auth System - Django RBAC API

Этот проект представляет собой бэкенд-приложение с проприетарной системой аутентификации и управления доступом на основе ролей (RBAC), созданное с использованием Django, Django Rest Framework и PostgreSQL. Он спроектирован как гибкая и безопасная основа для управления доступом пользователей к различным ресурсам внутри приложения.

Ядром проекта является специально разработанный фреймворк авторизации, который выходит за рамки стандартных разрешений Django, позволяя детально контролировать, какие действия могут выполнять различные роли пользователей над конкретными бизнес-объектами.

## Возможности

- **Кастомная модель пользователя**: Аутентификация по электронной почте вместо имени пользователя.
- **JWT-аутентификация**: Stateless-аутентификация с использованием JSON Web Tokens (JWT).
    - Генерация токена при входе в систему.
    - Безопасный выход из системы через добавление JWT в черный список.
- **Управление пользователями**: Полная поддержка жизненного цикла пользователя:
    - Регистрация с подтверждением пароля.
    - Вход/выход из системы.
    - Просмотр и обновление профиля (имя/фамилия).
    - "Мягкое" удаление аккаунта (`is_active=False`).
- **Управление доступом на основе ролей (RBAC)**:
    - Мощная кастомная система разрешений.
    - API-эндпоинты для администраторов для управления Ролями, Бизнес-Объектами и Разрешениями.
- **Имитация бизнес-приложения**: Примеры эндпоинтов (`/products/`, `/orders/`) для демонстрации работы системы контроля доступа.
- **Начальное заполнение данных**: Команда для заполнения базы данных тестовыми данными (роли, разрешения и пользователи).

## Архитектура системы контроля доступа

Логика авторизации построена на трех ключевых моделях:

1.  **`Role` (Роль)**: Представляет роль пользователя в системе (например, `Admin`, `Manager`, `User`). Пользователю назначается одна роль.

2.  **`BusinessObject` (Бизнес-объект)**: Представляет ресурс или сущность приложения, требующую контроля доступа (например, `products`, `orders`, `users`).

3.  **`Permission` (Разрешение)**: Это связующая таблица, которая определяет правила. Она соединяет `Role` с `BusinessObject` и определяет набор логических флагов для действий, которые данная роль может выполнять над этим объектом.

**Флаги разрешений:**
- `can_create`: Разрешение на создание новых объектов.
- `can_read_own` / `can_read_all`: Разрешение на чтение объектов, созданных самим пользователем, или всех объектов соответственно.
- `can_update_own` / `can_update_all`: Разрешение на обновление собственных/всех объектов.
- `can_delete_own` / `can_delete_all`: Разрешение на удаление собственных/всех объектов.

Такая структура позволяет администратору динамически определять, например, что роль `Manager` может читать все (`read_all`) заказы (`orders`), но обновлять (`update_own`) только собственные продукты (`products`).

## Стек технологий

- **Бэкенд**: Python, Django, Django Rest Framework
- **База данных**: PostgreSQL
- **Аутентификация**: PyJWT для кастомной обработки JWT
- **Переменные окружения**: python-dotenv

## Начало работы

### Требования

- Python 3.10+
- PostgreSQL
- Инструмент для работы с виртуальными окружениями (например, `venv`)

### Установка и запуск

1.  **Клонируйте репозиторий:**
    ```sh
    git clone https://github.com/Udilainer/proprietary-access-control-system.git
    cd proprietary-access-control-system
    ```

2.  **Создайте и активируйте виртуальное окружение:**
    ```sh
    python -m venv venv
    source venv/bin/activate  # В Windows используйте `venv\Scripts\activate`
    ```

3.  **Установите зависимости:**
    ```sh
    pip install -r requirements.txt
    ```

4.  **Настройте переменные окружения:**
    -   Скопируйте файл-пример `.env`:
        ```sh
        cp .env.example .env
        ```
    -   Отредактируйте файл `.env`, указав ваши данные для подключения к БД и уникальный `SECRET_KEY`.

5.  **Настройте базу данных:**
    -   Примените миграции для создания таблиц в БД:
        ```sh
        python manage.py migrate
        ```

6.  **Заполните базу данных начальными данными:**
    -   Эта команда создаст роли, бизнес-объекты, разрешения и тестовых пользователей по умолчанию (`admin@example.com`, `manager@example.com`, `user@example.com`). Пароль для всех тестовых пользователей — `Test123!`.
        ```sh
        python manage.py seed_data
        ```

7.  **Запустите сервер для разработки:**
    ```sh
    python manage.py runserver
    ```
    API будет доступен по адресу `http://127.0.0.1:8000/`.

## API Эндпоинты

Все эндпоинты имеют префикс `/api/auth/`.

| Эндпоинт                 | Метод  | Описание                                       | Права доступа      |
| ------------------------ | ------ | ---------------------------------------------- | ------------------ |
| `/register/`             | `POST` | Регистрация нового пользователя.               | AllowAny           |
| `/login/`                | `POST` | Вход в систему и получение JWT.                | AllowAny           |
| `/logout/`               | `POST` | Выход из системы и добавление токена в черный список. | IsAuthenticated    |
| `/profile/`              | `GET`  | Просмотр своего профиля.                       | IsAuthenticated    |
| `/profile/`              | `PUT`  | Обновление имени и фамилии.                    | IsAuthenticated    |
| `/delete-account/`       | `POST` | "Мягкое" удаление своего аккаунта.             | IsAuthenticated    |
|                          |        |                                                |                    |
| **Управление RBAC** |        |                                                |                    |
| `/roles/`                | `CRUD` | Управление Ролями.                             | Разрешение `roles` |
| `/business-objects/`     | `CRUD` | Управление Бизнес-Объектами.                   | Разрешение `business_objects` |
| `/permissions/`          | `CRUD` | Управление Разрешениями для пар Роль/Объект.   | Разрешение `permissions` |
|                          |        |                                                |                    |
| **Имитация приложения** |        |                                                |                    |
| `/products/`             | `GET`  | Получить список имитируемых продуктов.         | Право на чтение `products` |
| `/orders/`               | `GET`  | Получить список имитируемых заказов.           | Право на чтение `orders` |
